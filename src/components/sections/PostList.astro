---
import { getCollection, type CollectionEntry } from "astro:content";

import { SITE } from "@/siteConfig";

import Post from "@/components/sections/Post.astro";
import CustomLink from "@/components/ui/CustomLink.astro";
import { getBaseEntries, sortEntriesDefault } from "@/lib/postsService";

const posts = getBaseEntries(await getCollection("blog"));
const sorted = sortEntriesDefault(posts);

const limit = SITE.blogHomePostLimit ?? 5;
const limited = sorted.slice(0, limit);
const hasMore = sorted.length > limit;
---

<h2 class="pt-8 sm:pt-12 pb-8 text-3xl font-semibold text-center text-base-content" data-testid="posts-section">Posts</h2>
<ul class="flex flex-col gap-4 list-none px-0 pb-12" data-testid="posts-list">
  {limited.map((post: CollectionEntry<"blog">) => (
    <Post post={post} refFrom="home" />
  ))}
  {hasMore && (
    <CustomLink link={{
      id: "view-all",
      title: "View all posts",
      description: "Browse the full archive of posts.",
      url: "/archive",
      icon: "lucide:archive",
      color: "neutral"
    }} />
  )}
</ul>

